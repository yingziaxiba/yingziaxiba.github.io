<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="referrer" content="never" />
    <title>正在播放</title>
    <style type="text/css">
        body,html,.dplayer {
    padding: 0;
    margin: 0;
    width: 100%;
    height: 100%;
    background-color: #000
}

a {
    text-decoration: none
}
    </style>
</head>

<body>
    <link rel="stylesheet" href="./splayer.min.css">
    <div id="dplayer"></div>
    <script src="./p2p.js"></script>
    <script src="./splayer.js?sp"></script>
    <script> 
    function getQueryVariable(variable)
{
       
      var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}
    var vdurl=getQueryVariable('url');
    var vdtp=getQueryVariable('type');

        var hlsjsConfig = {
            debug: false,
            maxBufferHole: 3,
            p2pConfig: {
                logLevel: 'warn',
                announce: "https://tracker.klink.tech",
                wsSignalerAddr: 'wss://signal.klink.tech/ws',
            }
        };
        var hls;
        var dp = new DPlayer({
            container: document.getElementById('dplayer'),
            autoplay: true,
            loop: true,
            screenshot: true,
            hotkey: true,
            preload: 'auto',
            video: {
                url: vdurl ,
                type: vdtp , //customHls是m3u8
                customType: {
                    'customHls': function(video, player) {
                        var isMobile = navigator.userAgent.match(/iPad|iPhone|Linux|Android|iPod/i) != null;
                        if (isMobile) {
                            var html = '<video src="' + video.src + '" controls="controls" autoplay="autoplay" width="100%" height="100%"></video>';
                            document.getElementById('dplayer').innerHTML = html;
                        } else {
                            hls = new Hls(hlsjsConfig);
                            hls.loadSource(video.src);
                            hls.attachMedia(video);
                            hls.engine.on('stats', function(data) {
                                var size = hls.engine.fetcher.totalP2PDownloaded;
                                hls.engine.fetcher.totalP2PDownloaded = 0;
                                if (size > 0) {
                                    hls.engine.signaler.signalerWs.send({
                                        action: 'stat',
                                        size: size
                                    });
                                }
                            })
                        }
                    }
                }
            }
        });
    </script> 
</body>

</html>
